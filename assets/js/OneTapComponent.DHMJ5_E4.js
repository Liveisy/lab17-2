import{x as Te}from"./compat.module.B6A616es.js";import{c as oe}from"./react.CBQg7Yk0.js";import{a as Ee,u as m,i as he,S as be,j as v,I as ie,k as ae,d as Ie,c as Z,l as ye,m as Se,n as Ne,o as ke,U as we,p as ve,q as l,r as Oe,s as Ae,V as Ce,t as Re,v as Le}from"./getStore.700mJ7cl.js";import{i as xe,c as De}from"./_baseFor.Bzwhonox.js";import{s as Me,c as Ue}from"./classes.Bmfc40AJ.js";import{g as se}from"./index.BmHI7pNt.js";import{R as de,u as ce,S as T,g as Pe,m as Ve,t as Ge}from"./RegisteredUserContext.rZttAUMo.js";import{a as ee,M as C,g as te,c as $e,o as re,b as Xe,i as qe,d as Fe,e as G}from"./incrementalBackoff.CRPZtrss.js";import{u as le}from"./AnalyticsProvider.BRB_d5ef.js";import{b as $,c as X}from"./redesignnav.5463139d.DhRtfShP.js";import{u as N}from"./jsxRuntime.module.CDNE9mLv.js";import{r as He}from"./ApolloWrapper.W8lg4Npw.js";import{q as Ke}from"./queries.SDt1FY47.js";import{A as K,h as R,x as ue,q as W,y as Y}from"./hooks.module.DTgcM_-a.js";import"./preact.module.CHyAod6_.js";import"./globalnav2.15dcd298.yarjxgix.js";import"./client.CDTOledn.js";import"./preload-helper.Chbwj59V.js";import"./objectSpread2.Cp7eGu5m.js";import"./es6.array.fill.Ckejl62L.js";import"./redesignnav.5ea64877.sBydiRji.js";import"./Link.rk31aN69.js";import"./Type.tdv_QGJ4.js";import"./redesignnav.b5a05b2c.4kPs0dl-.js";import"./isString.DoDQMVXe.js";import"./cookie-utils.CaDQHCDO.js";import"./apollo-constants.CVCHsjQc.js";import"./Button.CbKssGE2.js";import"./index.BuP4Omrx.js";import"./index.Db67pfic.js";import"./Text.BexERg3a.js";import"./v4.CmuCJv9j.js";import"./variables.CsV1324o.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},e=new Error().stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="b5931468-6a69-480d-dd4d-c2f73747aa49",t._sentryDebugIdIdentifier="sentry-dbid-b5931468-6a69-480d-dd4d-c2f73747aa49")}catch{}})();var z={},We=xe.default;Object.defineProperty(z,"__esModule",{value:!0});var ge=z.useTrackEvent=void 0,Ye=We(Me),je=He,ze=Ke,Be=function(e){var r=(0,je.useMutation)(ze.TrackEventMutation,e),s=(0,Ye.default)(r,2),n=s[0],i=s[1];return[function(a){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(o!==void 0&&o!=="absmartly"&&o!=="optimizely")throw Error(`
          Invalid vendor for the event "`.concat(a,`".
          vendor must be "absmartly" or "optimizely",
          if not supplied it will default to "optimizely".
          `));var E={eventKey:a,vendor:o,userAttributes:d};return n({variables:{trackEvents:[E]}})},i]};ge=z.useTrackEvent=Be;function j(t){this.message=t}j.prototype=new Error,j.prototype.name="InvalidCharacterError";var ne=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new j("'atob' failed: The string to be decoded is not correctly encoded.");for(var r,s,n=0,i=0,a="";s=e.charAt(i++);~s&&(r=n%4?64*r+s:s,n++%4)?a+=String.fromCharCode(255&r>>(-2*n&6)):0)s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);return a};function Je(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(r){return decodeURIComponent(ne(r).replace(/(.)/g,function(s,n){var i=n.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}(e)}catch{return ne(e)}}function L(t){this.message=t}function Qe(t,e){if(typeof t!="string")throw new L("Invalid token specified");var r=(e=e||{}).header===!0?0:1;try{return JSON.parse(Je(t.split(".")[r]))}catch(s){throw new L("Invalid token specified: "+s.message)}}L.prototype=new Error,L.prototype.name="InvalidTokenError";const Ze=({identifier:t})=>t.split(/[-_]/).slice(0,2).join("-"),q=(t,e)=>{e(`${Ze({identifier:t})}_registration`)},F=se("contextual-ignorable-reg-modal"),H="/home/taxes",et=({regFlow:t=v.CONTEXTUAL_IGNORABLE_MODAL,analyticsBase:e=ie,experimentId:r,flow:s="no-security-question"})=>{const n=le(),i=K(),[a,d]=R(!1),[o,E]=R(!0),[x,D]=R(!1),{isNavNarrow:M}=Ee(),g=m(_=>_.segmentTrackingAttributes),{isRegisteredUser:k}=ue(de),I=ce(),w=ae.includes(window?.location.pathname),h=W(_=>{I({type:_})},[I]),b=()=>{E(!1)},[f]=ge();return Y(()=>{if(ee(C.CONTEXTUAL)){F.debug("skip render: exponential backoff");return}if(te()!=="register"){F.debug('skip render: smart auth type is not "register"');return}if(k){F.debug("skip render: user is logged in");return}const _=()=>{q(e.driver_location,f)},y=p=>{switch(p){case v.IGNORABLE_MODAL:h(Z);break;case v.BRANDED_INVESTING_CONTEXTUAL_IGNORABLE_MODAL:h(Z);break;default:h(Ie)}},S={driverPageName:g?.driverPageName,deployableName:g?.deployableName,deployableVersion:g?.deployableVersion,driverPageViewId:g?.driverPageViewId,driverContentId:g?.driverContentId,driverContentSource:g?.driverContentSource,driverFlowName:g?.driverFlowName,...e.segmentTrackingAttributes},U=()=>{re({authType:"register",regTrackingAttributes:{cohort:e.cohort},segmentTrackingAttributes:{...S,driverElement:"link"},onSuccess:p=>{b(),r&&p?.current?.authType==="register"&&q(r,f),w?window?.location?.assign(H):Xe()(),y(t)}})},P=()=>{re({authType:"signin",regTrackingAttributes:{cohort:e.cohort},segmentTrackingAttributes:{...S,driverElement:"link"},onSuccess:()=>{b(),w&&window?.location?.assign(H)}})},V=()=>{n.track(T.ELEMENT_INTERACTION,{entity_name:e.entity_names.x_button,section_name:e.section_name,registration_cohort:e.cohort,element_type:e.additional_attributes.element_type}),qe(C.CONTEXTUAL),d(!0)};i?.current&&window.nwapi?.ui?.showAuthEmbed({el:i.current,authType:"register",flowConfig:{onClose:V,openRegisterAuthDialog:U,openSignInAuthDialog:P,sendTrkLocation:_,...w?{redirectUrl:`${window.location.origin}${H}`}:{}},version:2,flow:s,regTrackingAttributes:{entityNames:{authButtons:e.entity_names.auth_buttons},sectionName:e.section_name,cohort:e.cohort,additionalAttributes:e.additional_attributes},segmentTrackingAttributes:{...S,driverElement:"button"},regFlow:t,onSuccess(p){n.track(T.ELEMENT_IMPRESSION,{entity_name:e.entity_names.success,section_name:e.section_name,registration_cohort:e.cohort}),y(t),r&&p?.current?.authType==="register"&&q(r,f),$e(C.CONTEXTUAL)},onRenderFailure(){},onFailure(p){he.includes(p)?I({type:be,reason:p}):D(!0),n.track(T.ELEMENT_IMPRESSION,{entity_name:e.entity_names.error,section_name:e.section_name,registration_cohort:e.cohort})}})},[I,h,k,e,t,f,r,s,g,i]),Y(()=>{n.track(T.ELEMENT_IMPRESSION,{entity_name:e.entity_names.display,section_name:e.section_name,registration_cohort:e.cohort,element_type:e.additional_attributes.element_type})},[e]),a||!o||ee(C.CONTEXTUAL)||te()!=="register"||k?null:N("div",{className:oe($.modalWrapper,{[$.modalWrapperLarge]:x,[$.narrowModalHeight]:M}),id:"contextual-reg-modal-container-wrapper",children:N("div",{id:"contextual-reg-modal-desktop",ref:i})})},tt={regFlow:v.IGNORABLE_MODAL,analyticsBase:Se},rt={id:"fallback-contextual-modal",variants:{CONTROL:{id:"control",regFlow:v.CONTEXTUAL_IGNORABLE_MODAL,analyticsBase:ie}},includeExcludeConfig:{verticalsToInclude:Ne,contentTypesToInclude:ke}},nt=(t=ye)=>{const e=m(a=>a.experiments),r=m(a=>a.pageTaxonomy),s=m(a=>a.originatingUrl),n=[rt,...t].reverse().filter(({includeExcludeConfig:a})=>Fe({includeExcludeConfig:a,pageTaxonomy:r,originatingUrl:s}));if(!n.length)return tt;const i=n.find(({id:a})=>{const{assignedVariantName:d}=e?.find(o=>o.experimentName===a)??{};return d!==""&&d!=="control"});if(i){const{assignedVariantName:a}=e?.find(o=>o.experimentName===i.id)??{},d=Object.entries(i?.variants).find(o=>o[1]?.id===a);if(d)return{experimentId:i.id,...d[1]}}return{experimentId:n[0].id,...n[0].variants.CONTROL}},u=se("one-tap-component"),ot=t=>{const e=document.getElementsByTagName("head")[0],r=document.createElement("style");r.setAttribute("type","text/css"),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t)),e.appendChild(r)},it=Te(({setIsAuth0Loading:t,showGoogleOneTap:e=!0,showNerdwalletModals:r=!0})=>{const s=m(c=>c.isLoggedIn),n=m(c=>c.pageVertical),i=m(c=>c.pageTaxonomy),a=m(c=>c.clientID),d=m(c=>c.originatingUrl),o=m(c=>c.segmentTrackingAttributes),E=K(o),{identify:x,clearUncacheableTraits:D,getAnonymousId:M,track:g}=le(),k=ce(),{isRegisteredUser:I}=ue(de),[w,h]=R(!1),b=W(c=>{if(!c)return h(c);if(!r){u.debug("Suppressing Contextual Ignorable modal");return}h(c)},[r]),f=K(!1),_=G({pageVertical:n,pageTaxonomy:i,verticalsToSkip:Ce})||we.includes(d),y=G({pageVertical:n,pageTaxonomy:i,verticalsToSkip:Re})||ve.includes(d),S=_,U=y,{regFlow:P,analyticsBase:V,experimentId:p,flow:B}=nt()??{},J=W(()=>{const c=async O=>{g(T.ELEMENT_INTERACTION,{entity_name:l.entity_names.login,section_name:l.section_name,registration_cohort:l.cohort,element_type:l.additional_attributes.element_type}),t(!0);const A=await M(),Q=ae.includes(window.location.pathname),pe=Q?"taxes":"dashboard",{email:me}=Qe(O.credential),_e={anonymousUserId:A,driverPageName:o?.driverPageName,driverPageUrl:window?.location?.href,deployableName:o?.deployableName,deployableVersion:o?.deployableVersion,driverPageViewId:o?.driverPageViewId,driverContentId:o?.driverContentId,driverContentSource:o?.driverContentSource,driverFlowName:o?.driverFlowName,mostRecentTraditionalDeviceId:Pe("cookie_id"),...l.segmentTrackingAttributes,login_hint:me,connection:"google-oauth2",redirectTo:Q?`${window?.location?.protocol}//${window?.location?.host}/home/${pe}`:window.location.href},fe=Ve({url:"/api/nts/v1/login",params:_e,taxonomy:Ge(i)});window.location.href=fe};if(!e){u.debug("skip render: showGoogleOneTap === false"),u.debug("setting showingContextualIgnorable to true"),b(!0);return}if(!window?.google?.accounts?.id){u.debug("skip render: !window?.google?.accounts?.id"),u.debug("setting showingContextualIgnorable to true"),b(!0);return}u.debug("start render"),f.current=!0,window.google.accounts.id.initialize({callback:c,client_id:`${De.GOOGLE_API_CLIENT_ID}`,itp_support:!1,prompt_parent_id:"google-one-tap-embed-target",cancel_on_tap_outside:!1,use_fedcm_for_prompt:!0}),window.google.accounts.id.prompt(O=>{const A=document.getElementById("credential_picker_iframe");_&&!A?u.debug(`skip render on desktop: pageVertical === ${n} || originatingUrl === ${d}`):y&&A?(u.debug(`skip render on mobile: pageVertical === ${n} || originatingUrl === ${d}`),ot("#credential_picker_iframe {display: none !important;}")):(f.current&&E.current===o&&g(T.ELEMENT_IMPRESSION,{entity_name:l.entity_names.display,section_name:l.section_name,registration_cohort:l.cohort,element_type:l.additional_attributes.element_type}),u.debug("prompt displayed successfully")),O.isDismissedMoment()&&(u.debug("prompt not displayed"),g(T.ELEMENT_IMPRESSION,{entity_name:l.entity_names.failed_render,section_name:l.section_name,registration_cohort:l.cohort,element_type:l.additional_attributes.element_type}),u.debug("skip G1T render after dismissal"),b(!0)),O.isSkippedMoment()&&(g(T.ELEMENT_INTERACTION,{entity_name:l.entity_names.x_button,section_name:l.section_name,registration_cohort:l.cohort,element_type:l.additional_attributes.element_type}),u.debug("prompt cancelled"))})},[_,y,d,n,k,o,x]);return Y(function(){f.current&&E.current===o||(G({pageVertical:n,pageTaxonomy:i,verticalsToSkip:Le})?u.debug(`skip render entirely: pageVertical === ${n}`):Oe.includes(d)?u.debug(`skip render entirely: originatingUrl === ${d}`):Ae.includes(a)?u.debug(`skip render entirely: clientID === ${a}`):s?u.debug("skip render: User Logged In"):(E.current!==o&&b(!1),J()))},[a,s,I,J,d,i,n,D,o]),s?null:w?N("div",{className:oe({[X.skipMobileDisplay]:U,[X.skipDesktopDisplay]:S}),id:"contextual-reg-modal-container",children:N(et,{regFlow:P,analyticsBase:V,experimentId:p,flow:B})}):N("div",{className:X.googleOneTapWrapper,children:N("div",{id:"google-one-tap-embed-target",className:Ue({"display-none":S})})})});it.displayName="OneTapComponent";export{it as default};
//# sourceMappingURL=OneTapComponent.DHMJ5_E4.js.map
